<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  </head>
  <body>
    <form>
      <fieldset>
      <label for="module">Can I require</label>
      <input type="text" name="module" placeholder="mongodb">?
      <div>
      	<h2></h2>Node version: <span class="node-version"></span></h2>
        <h2>Available modules</h2>
        <ul class="availables">
        </ul>
      </div>
      </fieldset>
    </form>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script type="text/sandbox" id="myapp">
      return function(context, cb) {
          try {
            require.resolve(context.data.module);
            cb(null, 'yes');
          } catch(e) {
            cb(null, 'nope.');
          }
      }
    </script>
    <script type="text/sandbox" id="list">
      var fs = require('fs');
      var natives = Object.keys(process.binding("natives")).filter(function(nativeDep) {
		    return nativeDep[0] !== '_';
		  }).map(function(native) {
			  return {version: 'native', name: native};
		  });

      return function(cb) {
	      cb(null, {
		      node_version: process.version,
		      modules: natives.concat(fs.readdirSync(__dirname + '/node_modules')
		        .filter(function(dir) {
			        return dir[0] !== '.';
		        })
		        .map(function(dep) {
				      var depObj = JSON.parse(fs.readFileSync(__dirname + '/node_modules/' + dep + '/package.json'));
				      return {
					      name : depObj.name,
					      version: depObj.version,
                homepage: depObj.homepage
				      }
				    }))
          });
        };
    </script>
    <script type="text/javascript">
      var $search = $('[name=module]');
      var modules = [];

      $search.on('input', function(e) {
        renderMods(modules, $(this).val().trim());
      });

      function renderMods(data, filter) {
        $('.availables').html(modules
          .filter(function(package) {
            if (!filter) return true;
            return package.name.indexOf(filter) !== -1;
          }).map(function(package) {
            var $link;
            if ('native' === package.version) {
              $link = $('<a href="https://nodejs.org/docs/' + data.node_version + '/api/">').text(package.name + '(native)');
            } else {
              $link = $('<a href="' + package.homepage + '/tree/v' + package.version + '">').text(package.name + ' - ' + package.version);
            }

            return $('<li>').html($link);
        }));
      }
    </script>
    <script type="text/javascript">
      $.ajax({
        url: 'https://webtask.it.auth0.com/api/run/wt-tehsis-gmail_com-1',
        method: 'POST',
        data: $('#list').text(),
        headers: {
          Authorization: 'Bearer eyJhbGciOiJIUzI1NiIsImtpZCI6IjIifQ.eyJqdGkiOiJkNDdkM2IzNGQyYjc0YTBkOWNjODA5ODc4ZDcxZDhjZCIsImlhdCI6MTQzMDAwMTg2MCwiY2EiOltdLCJkZCI6MSwidGVuIjoiL153dC10ZWhzaXMtZ21haWxfY29tLVswLTFdJC8ifQ.IUE2hx2O6lks1KpTrHpqFANPBqijr_uvWX_r-CcNj_E'
        }
        }).done(function (data) {
          var $link = $('<a href="https://nodejs.org/docs/' + data.node_version + '/api/">').text(data.node_version);
          $('.node-version').html($link);
          modules = data.modules;
          renderMods(modules);
        }).fail(function (xhr, status, error) {
          alert(error);
        });
    </script>
  </body>
</html>

<html>
  <body>
    <form>
      <input type="text" name="module" placeholder="mongodb">
      <input type="submit" >
      <div>
        <h2>Available modules</h2>
        <ul class="availables">
        </ul>
      </div>
    </form>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script type="text/sandbox" id="myapp">
      return function(context, cb) {
          try {
            require.resolve(context.data.module);
            cb(null, 'yes');
          } catch(e) {
            cb(null, 'nope.');
          }
      }
    </script>
    <script type="text/sandbox" id="list">
      return function(cb) {
        require('child_process').exec('npm ls --depth=0 --json', function(err, stdout, stderr) {
          if (err) return cb(err)
            cb(null, JSON.parse(stdout));
        });
      }
    </script>
    <script type="text/javascript">
      var $form = $('form');

      $form.on('submit', function(e) {
        e.preventDefault();
        var module_name = document.getElementsByName('module')[0].value;
        $.ajax({
          url: 'https://webtask.it.auth0.com/api/run/wt-tehsis-gmail_com-1?module=' + module_name,
          method: 'POST',
          data: $('#myapp').text(),
          headers: {
            Authorization: 'Bearer eyJhbGciOiJIUzI1NiIsImtpZCI6IjIifQ.eyJqdGkiOiJkNDdkM2IzNGQyYjc0YTBkOWNjODA5ODc4ZDcxZDhjZCIsImlhdCI6MTQzMDAwMTg2MCwiY2EiOltdLCJkZCI6MSwidGVuIjoiL153dC10ZWhzaXMtZ21haWxfY29tLVswLTFdJC8ifQ.IUE2hx2O6lks1KpTrHpqFANPBqijr_uvWX_r-CcNj_E'
          },
          dataType: 'text',
          }).done(function (data) {
            alert(data);
          }).fail(function (xhr, status, error) {
            alert(error);
          });
      });
    </script>
    <script type="text/javascript">
      $.ajax({
        url: 'https://webtask.it.auth0.com/api/run/wt-tehsis-gmail_com-1',
        method: 'POST',
        data: $('#list').text(),
        headers: {
          Authorization: 'Bearer eyJhbGciOiJIUzI1NiIsImtpZCI6IjIifQ.eyJqdGkiOiJkNDdkM2IzNGQyYjc0YTBkOWNjODA5ODc4ZDcxZDhjZCIsImlhdCI6MTQzMDAwMTg2MCwiY2EiOltdLCJkZCI6MSwidGVuIjoiL153dC10ZWhzaXMtZ21haWxfY29tLVswLTFdJC8ifQ.IUE2hx2O6lks1KpTrHpqFANPBqijr_uvWX_r-CcNj_E'
        },
        }).done(function (data) {
          $('.availables').append(Object.keys(data.dependencies).map(function(package) {
            return $('<li>').text(package + ' - ' + data.dependencies[package].version);
          }));
        }).fail(function (xhr, status, error) {
          alert(error);
        });
    </script>
  </body>
</html>
